function ZhSelectAutoCompleteController($scope,$rootScope,$timeout,templateManager,ScreenService,ZhUtil,SelectService,ZHPromise,EventChildPropagation,DecodeValueFieldService,$filter,metaDataFactory){function getNewData(dataSets){var data;result=dataSets.dataset;var keys=Object.keys(result);if(keys&&keys.length>0&&"0"!==keys[0]){var dataSetName=$scope.field.dataSource.name.split("/").pop();result[dataSetName]&&(data=result[dataSetName])}else data=result;return data}function findNewValue(keys,field,value){var filter=[];keys.forEach(function(key){filter.push({name:key,operator:"=",value:value[key]})});var storageStrategy=field.dataSource.getStorageStrategy();return storageStrategy.getDataSource(field.dataSource.name,function(){},filter,1,2,void 0,0)}function prepareValue(valueFields,value){var valueBuilt={};return 1===valueFields.length&&"object"!=typeof value?valueBuilt[valueFields[0]]=value:valueBuilt=value,valueBuilt}function extendBehavior(){Util.extend(self,new ListTemplatable)}function getOnAddCode(){var onAddEventCode=$scope.field.events.filter(function(event){return"FieldOnAdd"===event.name});return onAddEventCode.length>0?onAddEventCode[0].code:"args.owner.widget.onAdd()"}function buildActions(field){var actions=[{label:ScreenService.i18n("Cancel"),showAsAction:"back",isVisible:!0,showOnForm:!0,showOnList:!0,hideIcon:!0,events:[{name:"ActionEvent",code:"ScreenService.closePopup(); args.owner.widget.afterClosePopup(args.owner.widget.selectField);",id:9998}]}];return"action"==field.showAddButtonAs&&actions.push({icon:"plus",showAsAction:"always|edit|checked_rows|view",isVisible:!0,showOnForm:!0,showOnList:!0,events:[{name:"ActionEvent",code:onAddCode,id:9999}]}),actions}function clearFieldValue(field){$scope.resetPlaceholderValue(),field.isReadOnly()||(field.clearByOutData(),field.clearByName(),field.clearByOutDescription(),field.dataSource.clearCheckedRows(),setChanged(field),field.change&&field.change(),$scope.clearAutoCompleteListData(),$scope.hideList(),templateManager.updateTemplate(),$scope.removeFocusOfInput())}function configTemplate(field){var template;return template=field.showSelectAs?"tree"===field.showSelectAs?"widget/tree/grid.html":"widget/"+field.showSelectAs+".html":"widget/list.html"}function buildFields(displayedField,key){this[key]={name:displayedField,showLabel:!1,showOnList:!0,mask:this.mask}}function insertLabels(label,key){this[key].label=label,this[key].showLabel=!0}function buildSelectWidgetFields(field){var fields=[];field.fields&&field.fields.length?fields=field.fields:field.descriptionFields.forEach(buildFields,fields),field.displayedFieldsLabels&&field.displayedFieldsLabels.forEach(insertLabels,fields),fields.forEach(function(currentElement){metaDataFactory.fieldFactory(currentElement,field.selectWidget,!0)})}function buildEvents(){return[{name:"WidgetAfterMoveRow",code:"args.owner.setSelected(args);",id:9999},{name:"WidgetAfterLoadDataSource",code:"args.owner.updateDatasource()",id:9999}]}function setSelected(args){(!$scope.field.allowSelectOnlyLastChild||$scope.field.allowSelectOnlyLastChild&&this.isTree($scope.field.selectWidget)&&isLastChild(args.row))&&(ScreenService.closePopup(),self.onAutoCompleteItemClick(args.row))}function afterClosePopup(field){field.element&&field.element.focus()}function buildSelectWidget(field,widgetConfig){field.selectWidget||(field.selectWidget=metaDataFactory.widgetFactory({id:9e3,name:"Widget",label:field.label,template:widgetConfig.template,container:field.widget.container,isVisible:!0,popupNoBlock:!1,showDescriptionOrder:!1,floatingControl:{openSearch:!Util.isMobile(),defaultSearchField:field.defaultSearchField,customizationAction:{layout:!1,filter:!1,view:!1},xlsAction:!1,pdfAction:!1,csvAction:!1},parentProperty:field.parentProperty,primaryProperty:field.primaryProperty,expandingProperty:field.expandingProperty,breadcrumbProperty:field.breadcrumbProperty,order:field.order,reverse:field.reverse,bringGroupsCollapsed:field.bringGroupsCollapsed,orderFromGroups:field.orderFromGroups,selectField:field,showCheckbox:!1,onAdd:field.onAdd,showAddButtonAs:field.showAddButtonAs,addButtonText:field.addButtonText,noMatchText:field.noMatchText,searchNoMatchText:field.searchNoMatchText,fields:[],dataSource:field.dataSource,dataSourceFilter:field.dataSourceFilter,itemsPerPage:field.itemsPerPage||30,searchWithPagination:!!Util.isUndefinedOrNull(field.searchWithPagination)||field.searchWithPagination,hasPagination:!!Util.isUndefinedOrNull(field.hasPagination)||field.hasPagination,onDemand:field.onDemand,allowSelectOnlyLastChild:field.allowSelectOnlyLastChild,actions:widgetConfig.actions,events:EventChildPropagation.propagate(widgetConfig.widgetEvents,field),searchCriteria:field.searchCriteria}),buildSelectWidgetFields(field)),field.selectWidget.setSelected=setSelected,field.selectWidget.updateDatasource=updateDatasource,field.selectWidget.afterClosePopup=afterClosePopup}function processReload(isToReload,field){var defer=ZHPromise.defer();return isToReload?(field.selectWidget.searchCriteria={},field.reload().then(defer.resolve,defer.resolve)):defer.resolve(),defer.promise}function innerSearch(selectListSearch,field){if(Util.isArray(field.filterDefinitions)&&field.filterDefinitions.length){var dataSource=field.dataSource,filter=ZhUtil.buildFiltersInField(field,selectListSearch);dataSource.filter(filter,function(data){dataSource.data=data,templateManager.updateTemplate()})}}function cleanFieldSearch(field){innerSearch("",field)}function buildFieldWidget(field){cleanFieldSearch(field);var isToReload=!(!field.selectWidget||!Util.objectHasAnyValue(field.selectWidget.searchCriteria));return field.selectWidget||(initializeSelectWidget(field),isToReload=!(!field.dataSource||!field.dataSource.lazyLoad)),processReload(isToReload,field)}function buildWidgetConfig(field){var widgetConfig={};return widgetConfig.template=configTemplate(field),widgetConfig.actions=buildActions(field),widgetConfig.widgetEvents=buildEvents(),widgetConfig}function initializeSelectWidget(field){buildSelectWidget(field,buildWidgetConfig(field)),overrideReload(field)}function overrideReload(field){oldReload=field.selectWidget.reload,field.selectWidget.reload=function(){return dataInitialized?oldReload.call(field.selectWidget):ZHPromise.when()}}function removeElementFocus(field){field.element&&(field.element.blur(),window.getSelection().removeAllRanges())}function configValueFields(){var field=$scope.field;field.valueFields||(field.valueFields=[field.valueField])}function configDescriptionFields(){var field=$scope.field;field.descriptionFields=field.descriptionFields?field.descriptionFields:[field.descriptionField||field.name]}function orderDropdown(data,order){return $filter("orderBy")(data,order)}function updateDatasourceRemote(itemSearch,isToReload){if($scope.field.dataSource.rest&&(void 0!==itemSearch&&itemSearch!==lastSearch||isToReload)){if(!$scope.field.searchableFields)throw new Error("Field "+$scope.field.name+" must have searchableFields. ");var filterSet=!1,fieldName=$scope.field.searchableFields.join("|");$scope.filterToAdd||($scope.filterToAdd={},filterSet=!0),$scope.filterToAdd.name=fieldName,$scope.filterToAdd.operator="LIKE_ALL",$scope.filterToAdd.value=buildSearchValue(itemSearch),filterSet&&($scope.field.dataSourceFilter=$scope.field.dataSourceFilter||[],$scope.field.dataSourceFilter.push($scope.filterToAdd)),isMakingRequest=!0,$scope.field.dataSource.disableLoader&&$scope.showLoader&&$scope.showLoader(),$scope.field.dataSource.load($scope.field.dataSourceFilter,1,$scope.field.selectWidget.itemsPerPage).then(function(){$scope.field.selectWidget.order&&($scope.field.dataSource.data=orderDropdown($scope.field.dataSource.data,$scope.field.selectWidget.order),$scope.filteredData=$scope.field.dataSource.data),shouldSelectAfterLoad&&1===$scope.field.dataSource.data.length&&(self.addItemAsSelected($scope.field.dataSource.data[0],$scope.field),shouldSelectAfterLoad=!1),isMakingRequest=!1,$scope.field.dataSource.disableLoader&&$scope.hideLoader&&$scope.hideLoader()}),resetDropdown()}}function updateDatasourceLocal(itemSearch){var expression=function(row){var result=!1;return $scope.field.searchableFields.forEach(function(fieldName){var rowValue=String(row[fieldName]).toLowerCase();switch($scope.field.searchIn){case"beginning":result=!!rowValue.startsWith(itemSearch.toLowerCase())||result;break;case"end":result=!!rowValue.endsWith(itemSearch.toLowerCase())||result;break;default:result=rowValue.indexOf(itemSearch.toLowerCase())!==-1||result}}),result};$scope.filteredData=$filter("filter")($scope.field.dataSource.data,expression),$scope.field.selectWidget.order&&($scope.filteredData=orderDropdown($scope.filteredData,$scope.field.selectWidget.order)),resetDropdown(),$timeout(function(){$scope.$digest()},0,!1)}function updateDatasource(itemSearch,isToReload){itemSearch=itemSearch||$scope.itemSearch||"",$scope.shouldMakeRequest(itemSearch,isToReload)?updateDatasourceRemote(itemSearch,isToReload):updateDatasourceLocal(itemSearch),lastSearch=itemSearch}function onItemSearchChanged(itemSearch,isToReload){updateDatasource(itemSearch,isToReload),$scope.updateDropdown&&$scope.updateDropdown()}function propagateFieldDataSourceFilterToSelectWidget(fieldDataSourceFilter){filterUpdated=!0,$scope.field.selectWidget&&($scope.field.selectWidget.dataSourceFilter=fieldDataSourceFilter),updateDatasource($scope.itemSearch,!0)}function setOperator(){$scope.field.operator=$scope.field.operator||"="}function configHasPagination(){var field=$scope.field;void 0===field.hasPagination&&(field.hasPagination=!0)}function initializeFieldProperties(){configValueFields(),configDescriptionFields(),configHasPagination(),buildPropertiesToSearch(),setOperator(),initializeSelectWidget($scope.field)}function searchItem(itemIdentifier){function findItem(item){var result=!0;for(var valueField in valueFields)result&=item[valueFields[valueField]]==itemIdentifierArr[valueField];return result}var field=$scope.field,data=field.dataSource.data,valueFields=field.valueFields,itemIdentifierArr=itemIdentifier.split(" | ");return item=data.find(findItem),item}function changeByName(field,row){function buildCurrentRowValueFields(value,key){currentRow[value]=row[value]}var valueFields=field.valueFields,currentRow=field.widget.currentRow,fieldName=field.name;currentRow[fieldName]="",valueFields.forEach(buildCurrentRowValueFields),currentRow[fieldName]=self.getItemDescription(row)}function changeByOut(field,row){if(field.widget.currentRow){var outData=field.outData||{};Object.keys(outData).forEach(function(key){Array.isArray(outData[key])?outData[key].forEach(function(valueKey){field.widget.currentRow[valueKey]=row[key]}):field.widget.currentRow[outData[key]]=row[key]})}}function changeByDescription(field,row){field.widget.currentRow[field.outDescription]=self.getItemDescription(row)}function buildSearchValue(itemSearch){switch($scope.field.searchIn){case"beginning":return itemSearch+"%";case"end":return"%"+itemSearch;default:return"%"+itemSearch+"%"}}function addFieldNamesToPropertyToSearch(fields){fields.forEach(function(field){propertyToSearch.push(field)})}function buildPropertiesToSearch(){var field=$scope.field;$scope.field.searchWithPagination=!!Util.isUndefinedOrNull($scope.field.searchWithPagination)||$scope.field.searchWithPagination;var propertyToAdd=null;propertyToAdd=Util.isUndefined(field.searchableFields)?Util.isUndefined(field.displayedFields)?field.descriptionFields:field.displayedFields:field.searchableFields,addFieldNamesToPropertyToSearch(propertyToAdd)}function initializeValuesOnCurrentRow(){var currentRow=$scope.field.widget.currentRow,fieldName=$scope.field.name;currentRow[fieldName]=currentRow[fieldName]||""}function removeSelectedItemByIndex(index){var widgetParent=$scope.field.widget,fieldName=$scope.field.name;widgetParent.currentRow[fieldName].splice(index,1)}function resetDropdown(){$scope.dropDownLimit=10,$scope.viewMore=ScreenService.i18n("View more...")}function translateText(field,item){field.getTemplateSimpleName||Util.extend(field,new Templatable);var text=item[field.name];return DecodeValueFieldService.model(field,text)}var self=this,lastSearch="",propertyToSearch=[],isMakingRequest=!1,shouldSelectAfterLoad=!1;$scope.field.lazyLoadEvent=$scope.field.lazyLoadEvent||templateManager.project.lazyLoadEvent,$scope.isRequestBeingMade=function(){return isMakingRequest},$scope.selectAfterLoad=function(){shouldSelectAfterLoad=!0};var dataInitialized=!!Util.isUndefinedOrNull($scope.field.dataSource.lazyLoad)||!$scope.field.dataSource.lazyLoad;$scope.viewMore=ScreenService.i18n("View more..."),$scope.filteredData=[],$scope.showDropdown=!0;var filterUpdated=!1,oldFieldToggleDropdown=$scope.field.toggleDropdown;$scope.field.toggleDropdown=function(){$scope.showDropdown=!$scope.showDropdown};var oldFieldInitializeField=$scope.field.initializeField;$scope.field.initializeField=function(){dataInitialized||(dataInitialized=!0,updateDatasource(lastSearch,!0))};var parentReload=$scope.field.reload.bind($scope.field);$scope.field.reload=function(addictionalFilters){return $scope.field.initializeField(),parentReload(addictionalFilters).then(function(response){return updateDatasource(),response})};var oldFieldValue=$scope.field.value;$scope.field.value=function(value){if(!value)return this.widget.currentRow[this.name];var shouldMakeRequest=$scope.field.dataSource.rest&&$scope.field.hasPagination;if(currentRow=$scope.field.widget.currentRow,valueFields=$scope.field.valueFields,value=prepareValue(valueFields,value),shouldMakeRequest)findNewValue(valueFields,$scope.field,value).then(function(result){result=getNewData(result),1===result.length?self.addItemAsSelected(result[0],$scope.field):currentRow[$scope.field.name]=""});else{var row=$scope.field.dataSource.data.filter(function(row){var result=!0;return valueFields.forEach(function(key){row[key]!==value[key]&&(result=!1)}),result});1===row.length?self.addItemAsSelected(row[0],$scope.field):currentRow[$scope.field.name]=""}},extendBehavior();var onAddCode=getOnAddCode();!function(){return initializeValuesOnCurrentRow(),initializeFieldProperties(),$scope.field.dataSource.data}(),$scope.field.clearValue=function(){clearFieldValue(this)};var oldReload;$scope.processBeforeSelectOpenEvent=function(field){field.beforeSelectOpen&&field.beforeSelectOpen()},$scope.processAfterSelectOpenEvent=function(field){field.afterSelectOpen&&field.afterSelectOpen()},$scope.openField=function(field,$event){$event.stopPropagation(),$scope.hideList(),field.isReadOnly()||($scope.processBeforeSelectOpenEvent(field),removeElementFocus(field),$scope.inputWithEditableContent.click(),buildFieldWidget(field).then(function(){$scope.clearSearchFilter(),ScreenService.openPopup(field.selectWidget),$scope.processAfterSelectOpenEvent(field)}))};var oldFieldOpenField=$scope.field.openField;$scope.field.openField=function(){$scope.openField($scope.field)};var oldFieldClearByOutData=$scope.field.clearByOutData;$scope.field.clearByOutData=function(){for(var prop in this.outData)this.widget.currentRow[this.outData[prop]]=""}.bind($scope.field);var oldFieldClearByName=$scope.field.clearByName;$scope.field.clearByName=function(){this.widget.currentRow[this.name]=""}.bind($scope.field);var oldFieldClearByOutDescription=$scope.field.clearByOutDescription;if($scope.field.clearByOutDescription=function(){this.widget.currentRow[this.outDescription]=""}.bind($scope.field),$scope.selectField){var oldSelectFieldOpenField=$scope.selectField.openField;$scope.selectField.openField=function(){$scope.openField($scope.selectField)}}var setChanged=function(field){field.widget.currentRow.changed=!0};$scope.clearField=function(field,$event){$event.stopPropagation(),clearFieldValue(field)},$scope.hasValueSetted=function(){var field=$scope.field,currentRow=field.widget.currentRow;return!!currentRow[field.name]},$scope.$watch($scope.hasValueSetted,function(newVal){$scope.showSpan=newVal}),$rootScope.search=function(selectListSearch,field){var minLength=field.minimumInputLength||0;selectListSearch.length>minLength&&innerSearch(selectListSearch,field)},this.addItemAsSelected=function(item,field){(field.outData?changeByOut:changeByName)(field,item),field.outDescription&&changeByDescription(field,item),item.__isSelected=!0,field.dataSource.checkedRows=[item],setChanged(field),field._afterSelected&&field._afterSelected(item),field.change&&field.change()},$scope.getDescriptionFromSelectedValue=function(){var fieldName=$scope.field.name,currentRow=$scope.field.widget.currentRow;return DecodeValueFieldService.model($scope.field,currentRow[fieldName])},this.getItemIdentifier=function(item){var identifier=[],field=$scope.field,valueFields=field.valueFields;for(var valueField in valueFields)identifier.push(item[valueFields[valueField]]);return identifier.join(" | ")},$scope.$on("$destroy",function(){$scope.field.dataSourceFilter&&$scope.field.dataSourceFilter.forEach(function(filter){angular.equals(filter,$scope.filterToAdd)&&$scope.field.dataSourceFilter.splice($scope.field.dataSourceFilter.indexOf(filter),1)}),$scope.field.selectWidget&&oldReload&&($scope.field.selectWidget.reload=oldReload),$scope.field.toggleDropdown=oldFieldToggleDropdown,$scope.field.initializeField=oldFieldInitializeField,$scope.field.value=oldFieldValue,$scope.field.openField=oldFieldOpenField,$scope.field.clearByOutData=oldFieldClearByOutData,$scope.field.clearByName=oldFieldClearByName,$scope.field.clearByOutDescription=oldFieldClearByOutDescription,$scope.field.reload=parentReload,$scope.selectField&&($scope.selectField.openField=oldSelectFieldOpenField)}),$scope.shouldMakeRequest=function(itemSearch,isToReload){if($scope.field.searchWithPagination&&dataInitialized&&!isMakingRequest){if(itemSearch!=lastSearch||filterUpdated){filterUpdated=!1;var itemsPerPage=$scope.field.itemsPerPage||30,pageSize=30<itemsPerPage?30:itemsPerPage;return!(itemSearch.length>0&&itemSearch.indexOf(lastSearch)!==-1&&self.getData()&&self.getData().length<pageSize)||isToReload}return!1}return!1},updateDatasource(),$scope.$watch("field.dataSourceFilter",propagateFieldDataSourceFilterToSelectWidget,!0),$scope.$watch("itemSearch",Util.buildDebounceMethod(onItemSearchChanged,500,!1)),$scope.searchFilter=function(row){return Util.isUndefinedOrNull($scope.itemSearch)||propertyToSearch.some(function(data){return~row[data].indexOfLatin($scope.itemSearch)})},$scope.onAutoCompleteItemSelect=function(selectedItemIdentifier){var item=searchItem(selectedItemIdentifier);self.clearEditableInput(),Util.isUndefinedOrNull(item)||self.addItemAsSelected(item,$scope.field),$scope.removeFocusOfInput()},this.onAutoCompleteItemClick=function(clickedItem){self.clearEditableInput(),self.addItemAsSelected(clickedItem,$scope.field),$scope.removeFocusOfInput()};var isLastChild=function(row){return 0===row._childCount};this.getSelectionText=function(fieldRow){return $scope.field.placeholder&&!fieldRow?selectionText=$scope.field.placeholder:selectionText=fieldRow||ScreenService.i18n("Search"),selectionText},$scope.maintainWindow=function(field){if(field.maintainWindow){var maintainWindowFilter=SelectService.buildMaintainFilter(field);ScreenService.openWindow(field.maintainWindow,maintainWindowFilter)}},$scope.clearSearchFilter=function(){$scope.itemSearch=""},this.getFieldLabel=function(){return $scope.field.label},this.getSelectedValues=function(){return $scope.field.widget.currentRow[$scope.field.name]},this.getSelectedItemDescription=function(item){return item[$scope.field.descriptionField]},this.getData=function(){return $scope.filteredData},$scope.$watchCollection(function(){return self.getData()},function(newValues,oldValues){newValues!==oldValues&&$scope.changeDropdownListPosition&&$scope.changeDropdownListPosition()}),$scope.dropDownLimit=10,$scope.loadMore=function($event){20===$scope.dropDownLimit?($scope.dropDownLimit+=10,$scope.viewMore=ScreenService.i18n("Open search widget"),$scope.openList(),$event.stopPropagation()):$scope.dropDownLimit>=30?($timeout(function(){$scope.inputWithEditableContent.blur()},0,!1),resetDropdown(),$scope.openField($scope.field,$event)):($scope.dropDownLimit+=10,$scope.openList(),$event.stopPropagation())},$scope.shouldShowLoadMore=function(){return!!$scope.field.hasPagination&&$scope.filteredData.length>=$scope.dropDownLimit},this.getItemText=function(item){function buildTranslatedItemDescription(description,key){var field=fields.filter(function(field){return field.name===description})[0];itemDescription[key]=translateText(field,item)}function buildItemDescription(description,key){itemDescription[key]=item[description]}var itemDescription=[],descriptionFields=$scope.field.descriptionFields,displayedFields=$scope.field.displayedFields,textSpacer=$scope.field.textSpacer||" | ",fields=$scope.field.fields;return displayedFields?fields?displayedFields.forEach(buildTranslatedItemDescription):displayedFields.forEach(buildItemDescription):fields?descriptionFields.forEach(buildTranslatedItemDescription):descriptionFields.forEach(buildItemDescription),itemDescription.join(textSpacer)},this.getItemDescription=function(item){function buildTranslatedItemDescription(description,key){var field=fields.filter(function(field){return field.name===description})[0];itemDescription[key]=translateText(field,item)}function buildItemDescription(description,key){itemDescription[key]=item[description]}var itemDescription=[],descriptionFields=$scope.field.descriptionFields,textSpacer=$scope.field.textSpacer||" | ",fields=$scope.field.fields;return fields?descriptionFields.forEach(buildTranslatedItemDescription):descriptionFields.forEach(buildItemDescription),itemDescription=itemDescription.join(textSpacer)},this.onRemoveSelectedItem=function(removedItemIndex){removeSelectedItemByIndex(removedItemIndex)},$scope.clearAutoCompleteListData=function(){$scope.itemSearch="",$scope.clearInputFieldText(),$scope.autoCompleteListData=[],$scope.clearSelectedItem(),$scope.showSpan=!0},this.clearEditableInput=function(){$scope.inputWithEditableContent.val("")},this.shouldShowSpan=function(){var isReadOnly=$scope.field.isReadOnly();return isReadOnly||$scope.showSpan}}window.templateUrls=window.templateUrls||[];var packageName="zh-select-autocomplete",hasPackageRegistered=window.templateUrls.some(function(templateUrl){return templateUrl["package"]===packageName});hasPackageRegistered||window.templateUrls.push({"package":packageName,baseUrl:"./bower_components/"+packageName+"/dist/templates/"}),jQuery.extend(jQuery.expr[":"],{focusable:function(el){return $(el).is("a, button, :input, [tabindex]")}}),function(){function zhSelectAutocomplete($timeout,eventEngine){var ENTER=13,DOWN=40,ESC=27,TAB=9,UP=38,linkFunction=function(theScope,theElement){function clickListener(){var showSelect=$(element).find(".show-select");showSelect.click(function(event){event.stopPropagation()})}function createFocusListener(){$scope.inputWithEditableContent.focus(function(event){$scope.inputWithEditableContent.val($scope.itemSearch),$scope.resetPlaceholderValue(),$scope.inputWithEditableContent.select(),$scope.inputWithEditableContent.parent().scrollTop(0),$scope.showSpan=!1,$scope.changeDropdownListPosition(),$scope.$apply(),$scope.processBeforeSelectOpenEvent($scope.field),$scope.openList(),$scope.updateDropdown(),$scope.processAfterSelectOpenEvent($scope.field),$scope.selectAutoCompleteElement.closest("[zh-scroller]").on("scroll."+$scope.$id,function(){$scope.hideList()})})}function KeyPressNavegationListener(){var next,navegationKeyPress=$scope.selectAutoCompleteElement;navegationKeyPress.on("keydown","input,select",function(event){var EVENTKEY=event,spanList=$scope.selectAutoCompleteElement.find(".show-select span");if(EVENTKEY.which!==DOWN&&EVENTKEY.which!==UP||EVENTKEY.preventDefault(),EVENTKEY.which===ENTER||EVENTKEY.which===TAB)EVENTKEY.preventDefault(),isShowMore(selectedList)?$scope.loadMore(event):($scope.shouldMakeRequest($scope.itemSearch)?$scope.selectAfterLoad():canSelect(selectedList)&&($scope.selectItem(selectedList),$scope.inputWithEditableContent.val("")),getFocusableItems().length>1&&($scope.removeFocusOfInput(),$scope.focusOnNextItem(),$scope.hideList()));else if(EVENTKEY.which===DOWN)selectedList?(selectedList.removeClass("selected"),next=selectedList.next(),selectedList=next.length>0?next.addClass("selected"):spanList.eq(0).addClass("selected")):selectedList=spanList.eq(0).addClass("selected");else if(EVENTKEY.which===UP)selectedList?(selectedList.removeClass("selected"),next=selectedList.prev(),selectedList=next.length>0?next.addClass("selected"):spanList.last().addClass("selected")):selectedList=spanList.last().addClass("selected");else if(EVENTKEY.which===ESC)return $scope.hideList(),selectedList="",!1;if(navegationKeyPress){var index,itemList=$scope.selectAutoCompleteElement.find(".list-items"),item=navegationKeyPress.find(".selected");if(void 0!==item.offset())if(EVENTKEY.which===ENTER)$timeout(function(){spanList=$scope.selectAutoCompleteElement.find(".show-select span"),index=$scope.dropDownLimit-10,movimentation=32*(index+3.7)+item.outerHeight()-itemList.innerHeight(),animateItemFocus(itemList,movimentation),selectedList=spanList.eq(index),selectedList.addClass("selected")},1e3,!1);else{index=parseInt(item.attr("data-item-index"))||parseInt(item.prev().attr("data-item-index"))+1;var movimentation=0;item.position().top+item.outerHeight()>itemList.innerHeight()?(movimentation=32*index+item.outerHeight()-itemList.innerHeight(),animateItemFocus(itemList,movimentation)):item.position().top<0&&(movimentation=32*index,animateItemFocus(itemList,movimentation))}}})}function animateItemFocus(itemList,movimentation){itemList.finish().animate({scrollTop:movimentation},500)}function getFocusableItems(){return $(":focusable")}function canSelect(selectedList){return"string"==typeof selectedList&&""!==selectedList||"object"==typeof selectedList&&""!==selectedList.text()&&selectedList.attr("data-item-identifier")}function isShowMore(selectedItem){return selectedItem&&selectedItem.hasClass("view-more")}function updateListPosition(listItemsElement,dropdownOffset,dropdown){var popupModal=$(".popup-modal");popupModal.length&&(dropdownOffset-=popupModal.offset().top),$timeout(function(){listItemsElement.css("top",dropdownOffset+dropdown.outerHeight()-getParentFixedTop(dropdown)),dropdown.offset().top+dropdown.outerHeight()+listItemsElement.outerHeight()+10>$(window).height()?listItemsElement.css("margin-top",-1*(dropdown.outerHeight()+listItemsElement.outerHeight())):listItemsElement.css("margin-top",0)},0,!1)}function updateListWidth(listItemsElement,dropdown){listItemsElement.width()!==dropdown.innerWidth()&&listItemsElement.width(dropdown.innerWidth())}function getParentFixedTop(el){var parents=el.parents(),top=0;return parents.each(function(idx,item){if(item=$(item),("fixed"===item.css("position")||"absolute"===item.css("position"))&&item.parent()&&("fixed"===item.parent().css("position")||"absolute"===item.parent().css("position")))return top=item.offset().top,!1}),top}var lastMouseDownElement,lazyLoadEventIndex,$scope=theScope,element=theElement,selectedList="",loaderElement=$("img.autocomplete-loading-icon"),namespace=$scope.$id,documentEvents=[];$scope.hideLoader=function(){loaderElement.hide()},$scope.showLoader=function(){loaderElement.css("display","initial")},$scope.itemSearch=$scope.itemSearch||"",$scope.selectAutoCompleteElement=$(element),$scope.inputWithEditableContent=$(element).find(".editable");var initialPlaceholderValue;$scope.spanValueField=$(element).find("span"),$scope.inputWithEditableContent.change(function(e){e.stopPropagation()}),$scope.field.element.click(function(e){e.stopPropagation()}),$scope.field.lazyLoadEvent&&(lazyLoadEventIndex=eventEngine.bindEvent($scope.inputWithEditableContent,$scope.field.lazyLoadEvent,function(){$scope.field.initializeField()})),$("div.zh-background-loading").mouseup(function(e){lastMouseDownElement&&lastMouseDownElement===$scope.inputWithEditableContent[0]&&$scope.inputWithEditableContent.click()}),$(document).on("mousedown."+namespace,function(e){lastMouseDownElement=e.target}),documentEvents.push("mousedown"),createFocusListener(),clickListener(),KeyPressNavegationListener(),$scope.resetPlaceholderValue=function(){initialPlaceholderValue?$scope.inputWithEditableContent[0].placeholder=initialPlaceholderValue:initialPlaceholderValue=$scope.inputWithEditableContent[0].placeholder},$scope.updateDropdown=function(){if(0===$scope.selectAutoCompleteElement.find(".selected").length&&$scope.itemSearch){var spanList=$scope.selectAutoCompleteElement.find(".show-select span");selectedList=spanList.eq(0).addClass("selected")}return selectedList},$scope.openList=function(){$(".zh-select-autocomplete .show-select").css("display","none"),$scope.selectAutoCompleteElement.find(".show-select").css("display","block"),$scope.selectAutoCompleteElement.find(".list-items").scrollTop(0)},$scope.changeDropdownListPosition=function(){var dropdown=$scope.selectAutoCompleteElement.find(".zh-select-autocomplete"),dropdownOffset=dropdown.offset().top,listItemsElement=$scope.selectAutoCompleteElement.find(".list-items");updateListWidth(listItemsElement,dropdown),updateListPosition(listItemsElement,dropdownOffset,dropdown)},$scope.clearInputFieldText=function(){$scope.selectAutoCompleteElement.find("input:text").val("")},$scope.hideList=function(){$scope.selectAutoCompleteElement.find(".show-select").hide(),$scope.selectAutoCompleteElement.find(".show-select span").removeClass("selected"),$scope.selectAutoCompleteElement.closest("[zh-scroller]").off("scroll."+$scope.$id)},$scope.selectItem=function(selectedList){if(selectedList){selectedItem=selectedList.text();var itemIdentifier=selectedList.attr("data-item-identifier");$scope.onAutoCompleteItemSelect(itemIdentifier)}},$scope.focusOnNextItem=function(){$scope.inputHasFocus=!1,$canfocus=getFocusableItems();var index=$canfocus.index(document.activeElement)+1;index>=$canfocus.length&&(index=0),$canfocus.eq(index).focus()},$scope.focusOnInput=function(){$timeout(function(){$scope.inputWithEditableContent.focus()},0,!1)},$scope.removeFocusOfInput=function(){$timeout(function(){$scope.inputWithEditableContent.blur(),$scope.itemSearch&&($scope.inputWithEditableContent[0].placeholder=$scope.itemSearch),$scope.hideList(),$scope.showSpan=$scope.hasValueSetted(),$scope.clearInputFieldText()})},$scope.clearSelectedItem=function(){var item=$scope.inputWithEditableContent.find(".selected");selectedList="",item.removeClass("selected")},$(document).on("click."+namespace,function(event){$.contains($scope.selectAutoCompleteElement[0],event.target)||$scope.removeFocusOfInput()}),documentEvents.push("click"),$scope.$on("$destroy",function(){documentEvents.forEach(function(eventName){$(document).off(eventName+"."+namespace)}),$("div.zh-background-loading").off("mouseup"),$scope.selectAutoCompleteElement.closest("[zh-scroller]").off("scroll."+$scope.$id),eventEngine.unbindEvent($scope.inputWithEditableContent,$scope.field.lazyLoadEvent,lazyLoadEventIndex)})};return{restrict:"A",link:linkFunction}}var ZeedhiDirectives=angular.module("ZeedhiDirectives");ZeedhiDirectives.directive("zhSelectAutocomplete",["$timeout","eventEngine",zhSelectAutocomplete])}(),function(){function registerSelectAutocomplete(decodeTemplateFieldService){decodeTemplateFieldService.registerViewTemplate("zh-select-autocomplete#field/select-autocomplete.html","zh-select-autocomplete#field/select-autocomplete-view.html")}Configuration(registerSelectAutocomplete)}();